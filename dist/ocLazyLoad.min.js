/**
 * ocLazyLoad - Load modules on demand (lazy load) with angularJS
 * @version v0.2.0
 * @link https://github.com/ocombe/ocLazyLoad
 * @license MIT
 * @author Olivier Combe <olivier.combe@gmail.com>
 */
!function(){"use strict";function e(e){var n=[];return angular.forEach(e.requires,function(e){-1===u.indexOf(e)&&n.push(e)}),n}function n(e){try{angular.module(e)}catch(n){if(/No module/.test(n)||n.message.indexOf("$injector:nomod")>-1)return!1}return!0}function r(e,n,r){if(n){var o,t,a,u;try{for(o=0,t=n.length;t>o;o++)if(a=n[o],angular.isArray(a)){if(!e.hasOwnProperty(a[0]))return r.error("unsupported provider "+a[0]);u=e[a[0]],u[a[1]].apply(u,a[2])}}catch(i){throw r.error(i.message),i}}}function o(e,n,a){if(n){var i,l,c,f=[];for(i=n.length-1;i>=0;i--)l=n[i],"string"!=typeof l&&(l=t(l)),!l||u.indexOf(l)>-1||(u.push(l),c=angular.module(l),o(e,c.requires,a),f=f.concat(c._runBlocks),r(e,c._invokeQueue,a),r(e,c._configBlocks,a),n.pop());var s=e.getInstanceInjector();angular.forEach(f,function(e){try{s.invoke(e)}catch(n){n.message&&(n.message+=" from "+l),a.error(n.message)}})}return null}function t(e){return e.name?e.name:null}function a(e){function n(e){return e&&t.push(e)}var r,o,t=[e],a=["ng:app","ng-app","x-ng-app","data-ng-app"],i=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;angular.forEach(a,function(r){a[r]=!0,n(document.getElementById(r)),r=r.replace(":","\\:"),e.querySelectorAll&&(angular.forEach(e.querySelectorAll("."+r),n),angular.forEach(e.querySelectorAll("."+r+"\\:"),n),angular.forEach(e.querySelectorAll("["+r+"]"),n))}),angular.forEach(t,function(n){if(!r){var t=" "+e.className+" ",u=i.exec(t);u?(r=n,o=(u[2]||"").replace(/\s+/g,",")):angular.forEach(n.attributes,function(e){!r&&a[e.name]&&(r=n,o=e.value)})}}),r&&!function l(e){if(-1===u.indexOf(e)){u.push(e);var n=angular.module(e);angular.forEach(n.requires,l)}}(o)}var u=["ng"],i=angular.module("oc.lazyLoad",["ng"]);i.provider("$ocLazyLoad",["$controllerProvider","$provide","$compileProvider","$filterProvider","$injector","$animateProvider",function(r,t,i,l,c,f){function s(e,n){if(-1===filesLoaded.indexOf(n)){var r;switch(e){case"css":r=document.createElement("link"),r.type="text/css",r.rel="stylesheet",r.href=n;break;default:throw'Requested type "'+e+'" is not known. Could not inject "'+n+'"'}filesLoaded.push(n),h.insertBefore(r,h.lastChild)}}var d,g={},p=[],m={$controllerProvider:r,$compileProvider:i,$filterProvider:l,$provide:t,$injector:c,$animateProvider:f},h=document.getElementsByTagName("head")[0];null===h&&(h=document.getElementsByTagName("body")[0]),this.$get=["$timeout","$log","$q","$templateCache","$http","$rootElement",function(r,t,a,i,l,c){var f;return m.getInstanceInjector=function(){return f?f:f=c.data("$injector")},{getModuleConfig:function(e){return g[e]?g[e]:null},setModuleConfig:function(e){return g[e.name]=e,e},getModules:function(){return u},getModuleName:function(e){var n;return n="string"==typeof e?e:"object"==typeof e&&e.hasOwnProperty("name")&&"string"==typeof e.name?e.name:void 0},loadTemplateFile:function(e,n){angular.isString(e)&&(e=[e]);var r=[];return angular.forEach(e,function(e){var o=a.defer();r.push(o.promise),-1===p.indexOf(e)||angular.isDefined(n)&&n.cache===!1?l.get(e,n).success(function(n){angular.forEach(angular.element(n),function(e){"SCRIPT"===e.nodeName&&"text/ng-template"===e.type&&i.put(e.id,e.innerHTML)}),p.push(e),o.resolve()}).error(function(n){t.error('Error load template "'+e+'": '+n)}):o.resolve()}),a.all(r)},load:function(i){function l(r){var o,u,i,c,f=[];return o=g.getModuleName(r),u=angular.module(o),i=e(u),angular.forEach(i,function(e){var u,i;if("string"==typeof e){if(u=g.getModuleConfig(e),null===u)return void h.push(e);e=u}return n(e.name)||-1!==h.indexOf(e.name)?void("string"!=typeof r&&t.warn('Module "',o,'" attempted to redefine configuration for dependency "',e.name,'"\nExisting:',g.getModuleConfig(e.name),"Ignored:",e)):("object"==typeof e&&(e.hasOwnProperty("name")&&e.name&&(g.setModuleConfig(e),h.push(e.name)),e.hasOwnProperty("css")&&0!==e.css.length&&angular.forEach(e.css,function(e){s("css",e)})),void(e.hasOwnProperty("files")&&0!==e.files.length&&(i=a.defer(),e.files&&(f.push(i.promise),d(e.files,function(){l(e).then(function(){i.resolve()})})))))}),c=a.defer(),a.all(f).then(function(){c.resolve()}),c.promise}var c,f,g=this,p=null,h=[],v=[],y=a.defer();if(angular.isArray(i))return angular.forEach(i,function(e){v.push(g.load(e))}),a.all(v).then(function(){y.resolve()}),y.promise;if(c=g.getModuleName(i),n(c)&&-1!==u.indexOf(c))return h.push(c),y.resolve(),y.promise;if("string"==typeof i?p=g.getModuleConfig(i):"object"==typeof i&&(p=g.setModuleConfig(i)),null===p)throw f='Module "'+c+'" is not configured, cannot load.',t.error(f),f;return h.push=function(e){-1===this.indexOf(e)&&Array.prototype.push.apply(this,arguments)},d(p.files,function(){h.push(c),l(c).then(function(){o(m,h,t),r(function(){y.resolve(p)})})}),y.promise}}}],this.config=function(e){if("undefined"==typeof e.asyncLoader)throw"You need to define an async loader such as requireJS or script.js";if(d=e.asyncLoader,a(angular.element(window.document)),e.loadedModules){var n=function(e){u.indexOf(e)<0&&(u.push(e),angular.forEach(angular.module(e).requires,n))};angular.forEach(e.loadedModules,n)}e.modules&&(angular.isArray(e.modules)?angular.forEach(e.modules,function(e){g[e.name]=e}):g[e.modules.name]=e.modules)}}]),i.directive("ocLazyLoad",["$http","$log","$ocLazyLoad","$compile","$timeout","$templateCache",function(e,n,r,o,t,a){return{link:function(t,u,i){function l(){f&&(f.$destroy(),f=null),u.html("")}function c(r,o){var t;"undefined"!=typeof(t=a.get(r))?o(t):e.get(r).success(function(e){a.put("view:"+r,e),o(e)}).error(function(e){n.error('Error load template "'+r+'": '+e)})}var f,s=t.$eval(i.ocLazyLoad).onload||"";t.$watch(i.ocLazyLoad,function(e){e?r.load(e).then(function(e){e.template&&c(e.template,function(e){f=t.$new(),u.html(e);var n=u.contents(),r=o(n);r(f),f.$emit("$includeContentLoaded"),f.$eval(s)})}):l()})}}}])}();